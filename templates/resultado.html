<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Monitoreo de Drones · Resultados</title>

  <link
    href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
    rel="stylesheet"
    integrity="sha384-ENjdO4Dr2bkBIFxQpeo2V6ijYj6qVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo"
    crossorigin="anonymous"
  />

  <link rel="stylesheet" href="{{ url_for('static', filename='css/styles.css') }}" />

  <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>

  <script>
    window.MathJax = {
      tex: {
        inlineMath: [['$', '$'], ['\\(', '\\)']]
      }
    };
  </script>
  <script
    src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"
    id="MathJax-script"
    async
  ></script>
</head>
<body>

  <div class="container">
    <h1 class="text-center mb-4">Resultados de la Simulación</h1>

    <div class="card mb-4">
      <div class="card-header">
        <h4 class="mb-0">Parámetros y Ecuaciones</h4>
      </div>
      <div class="card-body">
        <div class="row gy-3">
          <div class="col-md-6">
            <div class="border rounded p-3 h-100">
              <h5>Drone 1 (Original)</h5>
              <p class="mb-1"><strong>RUT:</strong> {{ rut1 }}</p>
              <p class="mb-1">
                <strong>Dígitos d₁…d₈:</strong>
                {% for d in digits1 %}
                  d{{ loop.index }} = {{ d }}{% if not loop.last %}, {% endif %}
                {% endfor %}
              </p>
              <p class="mb-1"><strong>Centro (h, k):</strong> ({{ h1 }}, {{ k1 }})</p>
              <p class="mb-1"><strong>Semiejes (a, b):</strong> ({{ a1 }}, {{ b1 }})</p>
              <p class="mb-1"><strong>Orientación:</strong> {{ orientation1 | capitalize }}</p>
              <p class="mb-1">
                <strong>Ecuación canónica:</strong>
                <span class="fs-6">
                  $$ {{ eq1_can }} $$
                </span>
              </p>
              <p class="mb-1">
                <strong>Ecuación general:</strong>
                <span class="fs-6">
                  $$ {{ eq1_gen }} $$
                </span>
              </p>
            </div>
          </div>

          <div class="col-md-6">
            <div class="border rounded p-3 h-100">
              <h5>Drone 2 (Original)</h5>
              <p class="mb-1"><strong>RUT:</strong> {{ rut2 }}</p>
              <p class="mb-1">
                <strong>Dígitos d₁…d₈:</strong>
                {% for d in digits2 %}
                  d{{ loop.index }} = {{ d }}{% if not loop.last %}, {% endif %}
                {% endfor %}
              </p>
              <p class="mb-1"><strong>Centro (h, k):</strong> ({{ h2 }}, {{ k2 }})</p>
              <p class="mb-1"><strong>Semiejes (a, b):</strong> ({{ a2 }}, {{ b2 }})</p>
              <p class="mb-1"><strong>Orientación:</strong> {{ orientation2 | capitalize }}</p>
              <p class="mb-1">
                <strong>Ecuación canónica:</strong>
                <span class="fs-6">
                  $$ {{ eq2_can }} $$
                </span>
              </p>
              <p class="mb-1">
                <strong>Ecuación general:</strong>
                <span class="fs-6">
                  $$ {{ eq2_gen }} $$
                </span>
              </p>
            </div>
          </div>
        </div>
      </div>
    </div>

    {% if not colision %}
      <div class="alert alert-success" role="alert">
        <strong>Sin colisión:</strong> las trayectorias originales son seguras
        (<em>riesgo {{ nivel }}%</em>).
      </div>
    {% else %}
      <div class="alert alert-danger" role="alert">
        <strong>¡Colisión detectada!</strong>
        (<em>riesgo {{ nivel }}%</em>). A continuación se muestran las gráficas originales
        y los ajustes necesarios.
      </div>
    {% endif %}

    <div class="card mb-4">
      <div class="card-header">
        <h4 class="mb-0">Gráficas Originales</h4>
      </div>
      <div class="card-body">
        <div class="row">
          <div class="col-lg-6 plot-container">
            {{ plot2d_div_collision | safe }}
          </div>
          <div class="col-lg-6 plot-container">
            {{ plot3d_div_collision | safe }}
          </div>
        </div>
      </div>
    </div>

    {% if colision %}
      <div class="card mb-4">
        <div class="card-header">
          <h4 class="mb-0">Datos Tras Ajuste</h4>
        </div>
        <div class="card-body">
          <div class="row gy-3">
            <div class="col-md-6">
              <div class="border rounded p-3 h-100">
                <h5>Drone 1 (Ajustado)</h5>
                <p class="mb-1"><strong>Nuevo RUT:</strong> {{ rut1_adjusted }}</p>
                <p class="mb-1"><strong>Semiejes (a, b):</strong> ({{ a1_safe }}, {{ b1_safe }})</p>
              </div>
            </div>
            <div class="col-md-6">
              <div class="border rounded p-3 h-100">
                <h5>Drone 2 (Ajustado)</h5>
                <p class="mb-1"><strong>Nuevo RUT:</strong> {{ rut2_adjusted }}</p>
                <p class="mb-1"><strong>Semiejes (a, b):</strong> ({{ a2_safe }}, {{ b2_safe }})</p>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="card mb-4">
        <div class="card-header">
          <h4 class="mb-0">Gráficas Tras Ajuste (SAFE)</h4>
        </div>
        <div class="card-body">
          <div class="row">
            <div class="col-lg-6 plot-container">
              {{ plot2d_div_safe | safe }}
            </div>
            <div class="col-lg-6 plot-container">
              {{ plot3d_div_safe | safe }}
            </div>
          </div>
        </div>
      </div>
    {% endif %}

    <div class="text-center mb-4">
      <a href="{{ url_for('index') }}" class="btn btn-secondary btn-lg">
        ← Volver a Inicio
      </a>
    </div>
  </div>

  <script
    src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-RO1q7ERQ+gT9Fj3p8ZzPDVtgLOn9PRLV4R/bMqcMCP4dmH6KB0u2TR+08D6NQp"
    crossorigin="anonymous"
  ></script>
</body>
</html>
